{"remainingRequest":"C:\\Users\\Administrator\\Desktop\\后台\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Desktop\\后台\\src\\views\\authority\\role\\components\\setRole.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Administrator\\Desktop\\后台\\src\\views\\authority\\role\\components\\setRole.vue","mtime":1651135696136},{"path":"C:\\Users\\Administrator\\Desktop\\后台\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\Administrator\\Desktop\\后台\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\后台\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGdldE1lbnVPcGVyYXRlLCBzZXRSb2xlUGVybWlzc2lvbnMgfSBmcm9tICJAL2FwaS9yb2xlIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJzZXRSb2xlIiwKICBjb21wb25lbnRzOiB7fSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgZGVmYXVsdFByb3BzOiB7CiAgICAgICAgY2hpbGRyZW46ICJjaGlsZHJlbiIsCiAgICAgICAgbGFiZWw6ICJ0aXRsZSIsCiAgICAgIH0sCiAgICAgIGRyYXdlcjogZmFsc2UsCiAgICAgIHJvbGVJbmZvOiB7fSwKICAgICAgdHJlZU1lbnU6IFtdLAogICAgICB0cmVlQ2hlY2tlZEtleXM6IFtdLAogICAgfTsKICB9LAogIGNyZWF0ZWQoKSB7fSwKICBtb3VudGVkKCkge30sCiAgbWV0aG9kczogewogICAgc2hvdyhyb3cpIHsKICAgICAgdGhpcy5yb2xlSW5mbyA9IHJvdzsKICAgICAgdGhpcy5nZXRNZW51T3BlcmF0ZShyb3cubmFtZSk7CiAgICB9LAogICAgY2xvc2UoKSB7CiAgICAgIHRoaXMuJHJlZnMubWVudVRyZWUuc2V0Q2hlY2tlZEtleXMoW10pOwogICAgfSwKICAgIGNoYW5nZVJvbGUoKSB7CiAgICAgIGxldCBjaGVja2VkS2V5ID0gdGhpcy4kcmVmcy5tZW51VHJlZS5nZXRDaGVja2VkS2V5cygpOwogICAgICB0aGlzLnNldFJvbGVQZXJtaXNzaW9ucyh0aGlzLnJvbGVJbmZvLm5hbWUsIGNoZWNrZWRLZXkpOwogICAgfSwKCiAgICBhc3luYyBnZXRNZW51T3BlcmF0ZShyb2xlTmFtZSkgewogICAgICBsZXQgcmVzID0gYXdhaXQgZ2V0TWVudU9wZXJhdGUoeyByb2xlTmFtZTogcm9sZU5hbWUgfSk7CiAgICAgIGlmIChyZXMuc3RhdHVzID09IDIwMCkgewogICAgICAgIHRoaXMudHJlZU1lbnUgPSByZXMuZGF0YS5tZW51UGVyTGlzdDsKICAgICAgICB0aGlzLnRyZWVDaGVja2VkS2V5cyA9IHJlcy5kYXRhLmNoZWNrZWRLZXlzOwogICAgICAgIHRoaXMuZHJhd2VyID0gdHJ1ZTsKICAgICAgfQogICAgfSwKICAgIGFzeW5jIHNldFJvbGVQZXJtaXNzaW9ucyhyb2xlTmFtZSwgY2hlY2tlZEtleSkgewogICAgICBsZXQgcmVzID0gYXdhaXQgc2V0Um9sZVBlcm1pc3Npb25zKHsKICAgICAgICByb2xlTmFtZTogcm9sZU5hbWUsCiAgICAgICAgY2hlY2tlZEtleTogY2hlY2tlZEtleSwKICAgICAgfSk7CiAgICAgIGlmIChyZXMuc3RhdHVzID09IDIwMCkgewogICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygi5p2D6ZmQ6K6+572u5oiQ5YqfIik7CiAgICAgICAgdGhpcy5kcmF3ZXIgPSBmYWxzZTsKICAgICAgfQogICAgfSwKICAgIC8vIOiKgueCueiiq+eCueWHuwogICAgY2hlY2tDaGFuZ2UoZGF0YSwgY2hlY2tlZCwgaW5kZXRlcm1pbmF0ZSkgewogICAgICBsZXQgY2hlY2tlZEtleSA9IHRoaXMuJHJlZnMubWVudVRyZWUuZ2V0Q2hlY2tlZEtleXMoKTsKICAgICAgaWYgKGNoZWNrZWQpIHsKICAgICAgICBsZXQgc2VhcmNoSWQgPSBkYXRhLmlkLnN1YnN0cmluZygwLCA1KSArICIwMDEiOwogICAgICAgIGlmIChjaGVja2VkS2V5LmluZGV4T2Yoc2VhcmNoSWQpID09IC0xKSB7CiAgICAgICAgICBjaGVja2VkS2V5LnB1c2goc2VhcmNoSWQpOwogICAgICAgICAgdGhpcy4kcmVmcy5tZW51VHJlZS5zZXRDaGVja2VkS2V5cyhjaGVja2VkS2V5KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbGV0IHNlYXJjaFBhcklkID0gZGF0YS5pZC5zdWJzdHJpbmcoMCwgNSk7CiAgICAgICAgbGV0IHNlYXJjaExhc3RJZCA9IGRhdGEuaWQuc3Vic3RyaW5nKDUpOwogICAgICAgIGxldCBzZWFyY2hQYXJGbGFnID0gZmFsc2U7CiAgICAgICAgY2hlY2tlZEtleS5tYXAoKGl0ZW0pID0+IHsKICAgICAgICAgIGlmIChpdGVtLnN1YnN0cmluZygwLCA1KSA9PSBzZWFyY2hQYXJJZCkgc2VhcmNoUGFyRmxhZyA9IHRydWU7CiAgICAgICAgfSk7CiAgICAgICAgaWYgKHNlYXJjaExhc3RJZCA9PSAiMDAxIiAmJiBzZWFyY2hQYXJGbGFnKSB7CiAgICAgICAgICBjaGVja2VkS2V5LnB1c2goZGF0YS5pZCk7CiAgICAgICAgICB0aGlzLiRyZWZzLm1lbnVUcmVlLnNldENoZWNrZWRLZXlzKGNoZWNrZWRLZXkpOwogICAgICAgICAgdGhpcy4kbWVzc2FnZS53YXJuaW5nKCLlvZPliY3oj5zljZXmnInlhbbku5bmk43kvZzvvIzkuI3og73lj5bmtojmn6Xor6LmnYPpmZAiKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgfSwKfTsK"},{"version":3,"sources":["setRole.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"setRole.vue","sourceRoot":"src/views/authority/role/components","sourcesContent":["<template>\n  <div class=\"setRole\">\n    <el-drawer\n      :title=\"'【' + roleInfo.title + '】角色权限设置'\"\n      :visible.sync=\"drawer\"\n      direction=\"rtl\"\n      @closed=\"close\"\n      :size=\"600\"\n    >\n      <div class=\"clearflex\">\n        <!-- <el-button @click=\"close\">取 消</el-button> -->\n        <el-button type=\"primary\" @click=\"changeRole\">确 定</el-button>\n      </div>\n      <el-scrollbar style=\"height: calc(100% - 40px)\">\n        <div class=\"tree-menu\">\n          <el-tree\n            ref=\"menuTree\"\n            :data=\"treeMenu\"\n            :props=\"defaultProps\"\n            show-checkbox\n            :default-expand-all=\"true\"\n            node-key=\"id\"\n            :default-checked-keys=\"treeCheckedKeys\"\n            @check-change=\"checkChange\"\n          ></el-tree>\n        </div>\n      </el-scrollbar>\n    </el-drawer>\n  </div>\n</template>\n\n<script>\nimport { getMenuOperate, setRolePermissions } from \"@/api/role\";\nexport default {\n  name: \"setRole\",\n  components: {},\n  data() {\n    return {\n      defaultProps: {\n        children: \"children\",\n        label: \"title\",\n      },\n      drawer: false,\n      roleInfo: {},\n      treeMenu: [],\n      treeCheckedKeys: [],\n    };\n  },\n  created() {},\n  mounted() {},\n  methods: {\n    show(row) {\n      this.roleInfo = row;\n      this.getMenuOperate(row.name);\n    },\n    close() {\n      this.$refs.menuTree.setCheckedKeys([]);\n    },\n    changeRole() {\n      let checkedKey = this.$refs.menuTree.getCheckedKeys();\n      this.setRolePermissions(this.roleInfo.name, checkedKey);\n    },\n\n    async getMenuOperate(roleName) {\n      let res = await getMenuOperate({ roleName: roleName });\n      if (res.status == 200) {\n        this.treeMenu = res.data.menuPerList;\n        this.treeCheckedKeys = res.data.checkedKeys;\n        this.drawer = true;\n      }\n    },\n    async setRolePermissions(roleName, checkedKey) {\n      let res = await setRolePermissions({\n        roleName: roleName,\n        checkedKey: checkedKey,\n      });\n      if (res.status == 200) {\n        this.$message.success(\"权限设置成功\");\n        this.drawer = false;\n      }\n    },\n    // 节点被点击\n    checkChange(data, checked, indeterminate) {\n      let checkedKey = this.$refs.menuTree.getCheckedKeys();\n      if (checked) {\n        let searchId = data.id.substring(0, 5) + \"001\";\n        if (checkedKey.indexOf(searchId) == -1) {\n          checkedKey.push(searchId);\n          this.$refs.menuTree.setCheckedKeys(checkedKey);\n        }\n      } else {\n        let searchParId = data.id.substring(0, 5);\n        let searchLastId = data.id.substring(5);\n        let searchParFlag = false;\n        checkedKey.map((item) => {\n          if (item.substring(0, 5) == searchParId) searchParFlag = true;\n        });\n        if (searchLastId == \"001\" && searchParFlag) {\n          checkedKey.push(data.id);\n          this.$refs.menuTree.setCheckedKeys(checkedKey);\n          this.$message.warning(\"当前菜单有其他操作，不能取消查询权限\");\n        }\n      }\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n::v-deep {\n  .el-drawer__body {\n    overflow: auto;\n    overflow-y: hidden;\n  }\n  .el-scrollbar__wrap {\n    overflow-x: hidden;\n  }\n}\n.clearflex {\n  padding: 0 20px;\n  *zoom: 1;\n  text-align: right;\n}\n/deep/ .tree-menu {\n  padding: 20px;\n\n  .custom-tree-node {\n    display: flex;\n    justify-content: space-between;\n    width: 100%;\n    .menu-role {\n      flex: 1;\n      text-align: right;\n    }\n  }\n  .el-tree {\n    .el-tree-node__children {\n      .el-tree-node__children {\n        padding-left: 40px;\n        .el-tree-node {\n          display: inline-block;\n          .el-tree-node__content {\n            padding: 0 20px 0 0 !important;\n          }\n        }\n      }\n    }\n  }\n}\n</style>\n"]}]}