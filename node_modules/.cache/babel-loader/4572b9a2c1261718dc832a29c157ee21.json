{"remainingRequest":"C:\\Users\\Administrator\\Desktop\\个人\\后台\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\Administrator\\Desktop\\个人\\后台\\src\\permission.js","dependencies":[{"path":"C:\\Users\\Administrator\\Desktop\\个人\\后台\\src\\permission.js","mtime":1671440059250},{"path":"C:\\Users\\Administrator\\Desktop\\个人\\后台\\babel.config.js","mtime":1646805521000},{"path":"C:\\Users\\Administrator\\Desktop\\个人\\后台\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\个人\\后台\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiQzovVXNlcnMvQWRtaW5pc3RyYXRvci9EZXNrdG9wL1x1NEUyQVx1NEVCQS9cdTU0MEVcdTUzRjAvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL29iamVjdFNwcmVhZDIiOwoKLyoqCiAqIOi3r+eUseWuiOWNq++8jOWKqOaAgea3u+WKoOi3r+eUsQogKi8KaW1wb3J0IHJvdXRlciBmcm9tICcuL3JvdXRlcic7CmltcG9ydCBzdG9yZSBmcm9tICcuL3N0b3JlJzsKaW1wb3J0IE5Qcm9ncmVzcyBmcm9tICducHJvZ3Jlc3MnOyAvLyBQcm9ncmVzcyDov5vluqbmnaEKCmltcG9ydCAnbnByb2dyZXNzL25wcm9ncmVzcy5jc3MnOwppbXBvcnQgeyBNZXNzYWdlIH0gZnJvbSAnZWxlbWVudC11aSc7CnZhciB3aGl0ZUxpc3QgPSBbJy9sb2dpbiddOyAvLyDnmb3lkI3ljZUKCk5Qcm9ncmVzcy5jb25maWd1cmUoewogIHNob3dTcGlubmVyOiBmYWxzZQp9KTsKcm91dGVyLmJlZm9yZUVhY2goZnVuY3Rpb24gKHRvLCBmcm9tLCBuZXh0KSB7CiAgTlByb2dyZXNzLnN0YXJ0KCk7IC8vIOWKoOi9vei/m+W6puadoQoKICBkb2N1bWVudC50aXRsZSA9ICfpooTop4HmnKrmnaXlkI7lj7AnOwogIHZhciBoYXNSb2xlcyA9IHN0b3JlLmdldHRlcnMudXNlckluZm8ucm9sZXM7CiAgY29uc29sZS5sb2coaGFzUm9sZXMpOwogIHZhciBoYXNUb2tlbiA9IHN0b3JlLmdldHRlcnMudG9rZW47CgogIGlmIChoYXNUb2tlbikgewogICAgaWYgKHRvLnBhdGggPT09ICcvbG9naW4nKSB7CiAgICAgIG5leHQoewogICAgICAgIHBhdGg6ICcvJwogICAgICB9KTsKICAgICAgTlByb2dyZXNzLmRvbmUoKTsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBfaGFzUm9sZXMgPSBzdG9yZS5nZXR0ZXJzLnVzZXJJbmZvLnJvbGVzOwogICAgICBjb25zb2xlLmxvZyhfaGFzUm9sZXMpOwoKICAgICAgaWYgKCFfaGFzUm9sZXMgfHwgX2hhc1JvbGVzLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgc3RvcmUuZGlzcGF0Y2goJ3VzZXIvZ2V0VXNlckluZm8nKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgIHZhciBkYXRhID0gcmVzLmRhdGE7CiAgICAgICAgICBzdG9yZS5kaXNwYXRjaCgncm91dGVzL2dlbmVyYXRlUm91dGVzJywgewogICAgICAgICAgICAncm9sZXMnOiBkYXRhLnJvbGVzCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgLy8g5qC55o2ucm9sZXPmnYPpmZDnlJ/miJDlj6/orr/pl67nmoTot6/nlLHooagKICAgICAgICAgICAgcm91dGVyLmFkZFJvdXRlcyhzdG9yZS5nZXR0ZXJzLmFkZFJvdXRlcnMpOyAvLyDliqjmgIHmt7vliqDlj6/orr/pl67mnYPpmZDot6/nlLHooagKCiAgICAgICAgICAgIG5leHQoX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCB0byksIHt9LCB7CiAgICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZQogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKCd1c2VyL2xvZ291dCcpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICBNZXNzYWdlLmVycm9yKGVycm9yIHx8ICLpqozor4HlpLHotKXvvIzor7fph43mlrDnmbvlvZUiKTsKICAgICAgICAgICAgbmV4dCh7CiAgICAgICAgICAgICAgcGF0aDogJy8nCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbmV4dCgpOwogICAgICAgIE5Qcm9ncmVzcy5kb25lKCk7CiAgICAgIH0KICAgIH0KICB9IGVsc2UgewogICAgaWYgKHdoaXRlTGlzdC5pbmRleE9mKHRvLnBhdGgpICE9PSAtMSkgewogICAgICAvLyDngrnlh7vpgIDlh7rml7Ys5Lya5a6a5L2N5Yiw6L+Z6YeMCiAgICAgIG5leHQoKTsKICAgIH0gZWxzZSB7CiAgICAgIG5leHQoIi9sb2dpbiIpOwogICAgICBOUHJvZ3Jlc3MuZG9uZSgpOwogICAgfQogIH0KfSk7CnJvdXRlci5hZnRlckVhY2goZnVuY3Rpb24gKCkgewogIE5Qcm9ncmVzcy5kb25lKCk7IC8vIOe7k+adn1Byb2dyZXNzCn0pOw=="},{"version":3,"sources":["C:/Users/Administrator/Desktop/个人/后台/src/permission.js"],"names":["router","store","NProgress","Message","whiteList","configure","showSpinner","beforeEach","to","from","next","start","document","title","hasRoles","getters","userInfo","roles","console","log","hasToken","token","path","done","length","dispatch","then","res","data","addRoutes","addRouters","replace","catch","error","indexOf","afterEach"],"mappings":";;AAAA;AACA;AACA;AAEA,OAAOA,MAAP,MAAmB,UAAnB;AACA,OAAOC,KAAP,MAAkB,SAAlB;AACA,OAAOC,SAAP,MAAsB,WAAtB,C,CAAkC;;AAClC,OAAO,yBAAP;AACA,SACCC,OADD,QAEO,YAFP;AAIA,IAAMC,SAAS,GAAG,CAAC,QAAD,CAAlB,C,CAA8B;;AAC9BF,SAAS,CAACG,SAAV,CAAoB;AACnBC,EAAAA,WAAW,EAAE;AADM,CAApB;AAIAN,MAAM,CAACO,UAAP,CAAkB,UAACC,EAAD,EAAKC,IAAL,EAAWC,IAAX,EAAoB;AACrCR,EAAAA,SAAS,CAACS,KAAV,GADqC,CACnB;;AAClBC,EAAAA,QAAQ,CAACC,KAAT,GAAiB,QAAjB;AACA,MAAMC,QAAQ,GAAGb,KAAK,CAACc,OAAN,CAAcC,QAAd,CAAuBC,KAAxC;AACAC,EAAAA,OAAO,CAACC,GAAR,CAAYL,QAAZ;AACA,MAAMM,QAAQ,GAAGnB,KAAK,CAACc,OAAN,CAAcM,KAA/B;;AACA,MAAID,QAAJ,EAAc;AACb,QAAIZ,EAAE,CAACc,IAAH,KAAY,QAAhB,EAA0B;AACzBZ,MAAAA,IAAI,CAAC;AACJY,QAAAA,IAAI,EAAE;AADF,OAAD,CAAJ;AAGApB,MAAAA,SAAS,CAACqB,IAAV;AACA,KALD,MAKO;AACN,UAAMT,SAAQ,GAAGb,KAAK,CAACc,OAAN,CAAcC,QAAd,CAAuBC,KAAxC;AACAC,MAAAA,OAAO,CAACC,GAAR,CAAYL,SAAZ;;AACA,UAAI,CAACA,SAAD,IAAaA,SAAQ,CAACU,MAAT,IAAmB,CAApC,EAAuC;AACtCvB,QAAAA,KAAK,CAACwB,QAAN,CAAe,kBAAf,EAAmCC,IAAnC,CAAwC,UAAAC,GAAG,EAAI;AAC9C,cACCC,IADD,GAEID,GAFJ,CACCC,IADD;AAGA3B,UAAAA,KAAK,CAACwB,QAAN,CAAe,uBAAf,EAAwC;AACvC,qBAASG,IAAI,CAACX;AADyB,WAAxC,EAEGS,IAFH,CAEQ,YAAM;AACb;AACA1B,YAAAA,MAAM,CAAC6B,SAAP,CAAiB5B,KAAK,CAACc,OAAN,CAAce,UAA/B,EAFa,CAE8B;;AAC3CpB,YAAAA,IAAI,iCACAF,EADA;AAEHuB,cAAAA,OAAO,EAAE;AAFN,eAAJ;AAIA,WATD;AAUA,SAdD,EAcGC,KAdH,CAcS,UAAAC,KAAK,EAAI;AACjBhC,UAAAA,KAAK,CAACwB,QAAN,CAAe,aAAf,EAA8BC,IAA9B,CAAmC,YAAM;AACxCvB,YAAAA,OAAO,CAAC8B,KAAR,CAAcA,KAAK,IAAI,YAAvB;AACAvB,YAAAA,IAAI,CAAC;AACJY,cAAAA,IAAI,EAAE;AADF,aAAD,CAAJ;AAGA,WALD;AAMA,SArBD;AAsBA,OAvBD,MAuBO;AACNZ,QAAAA,IAAI;AACJR,QAAAA,SAAS,CAACqB,IAAV;AACA;AACD;AACD,GArCD,MAqCO;AACN,QAAInB,SAAS,CAAC8B,OAAV,CAAkB1B,EAAE,CAACc,IAArB,MAA+B,CAAC,CAApC,EAAuC;AACtC;AACAZ,MAAAA,IAAI;AACJ,KAHD,MAGO;AACNA,MAAAA,IAAI,UAAJ;AACAR,MAAAA,SAAS,CAACqB,IAAV;AACA;AACD;AACD,CApDD;AAsDAvB,MAAM,CAACmC,SAAP,CAAiB,YAAM;AACtBjC,EAAAA,SAAS,CAACqB,IAAV,GADsB,CACL;AACjB,CAFD","sourcesContent":["/**\n * 路由守卫，动态添加路由\n */\n\nimport router from './router'\nimport store from './store'\nimport NProgress from 'nprogress' // Progress 进度条\nimport 'nprogress/nprogress.css'\nimport {\n\tMessage\n} from 'element-ui'\n\nconst whiteList = ['/login']; // 白名单\nNProgress.configure({\n\tshowSpinner: false\n})\n\nrouter.beforeEach((to, from, next) => {\n\tNProgress.start() // 加载进度条\n\tdocument.title = '预见未来后台'\n\tconst hasRoles = store.getters.userInfo.roles;\n\tconsole.log(hasRoles);\n\tconst hasToken = store.getters.token;\n\tif (hasToken) {\n\t\tif (to.path === '/login') {\n\t\t\tnext({\n\t\t\t\tpath: '/'\n\t\t\t})\n\t\t\tNProgress.done()\n\t\t} else {\n\t\t\tconst hasRoles = store.getters.userInfo.roles;\n\t\t\tconsole.log(hasRoles);\n\t\t\tif (!hasRoles || hasRoles.length == 0) {\n\t\t\t\tstore.dispatch('user/getUserInfo').then(res => {\n\t\t\t\t\tconst {\n\t\t\t\t\t\tdata\n\t\t\t\t\t} = res;\n\t\t\t\t\tstore.dispatch('routes/generateRoutes', {\n\t\t\t\t\t\t'roles': data.roles\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\t// 根据roles权限生成可访问的路由表\n\t\t\t\t\t\trouter.addRoutes(store.getters.addRouters) // 动态添加可访问权限路由表\n\t\t\t\t\t\tnext({\n\t\t\t\t\t\t\t...to,\n\t\t\t\t\t\t\treplace: true\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tstore.dispatch('user/logout').then(() => {\n\t\t\t\t\t\tMessage.error(error || \"验证失败，请重新登录\")\n\t\t\t\t\t\tnext({\n\t\t\t\t\t\t\tpath: '/'\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tnext()\n\t\t\t\tNProgress.done()\n\t\t\t}\n\t\t}\n\t} else {\n\t\tif (whiteList.indexOf(to.path) !== -1) {\n\t\t\t// 点击退出时,会定位到这里\n\t\t\tnext()\n\t\t} else {\n\t\t\tnext(`/login`)\n\t\t\tNProgress.done()\n\t\t}\n\t}\n})\n\nrouter.afterEach(() => {\n\tNProgress.done() // 结束Progress\n})"]}]}